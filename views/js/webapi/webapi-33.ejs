<%- include ../../head %>
  <body>
 
    <%- include navbar %>

    <div class="container">
      <div class="row">
        <div class="col-sm-3">

        <%- include left %>
        
        </div>
        <div class="col-sm-9">
          <div class="panel panel-primary">
          <div class="panel-heading">witter API（ログイン後のツイートを取得）</div>
          <div class="panel-body">
<p>TwitterのAPIはv2.0に移行するために現在v1.1が使われています。インターネット上にv1.0の情報が多いので注意しましょう。v1.0のAPIはすでに廃止されており、v1.1ではOAuthで認証する仕様に変更されています。</p>

<p>「<a href="https://dev.twitter.com/apps" target="_blank">Twitter Developers</a>」にアクセスし、取得済みのTwitterアカウントでログインします。</p>

<p>「Create a new application」ボタンを押してアプリケーションを作成します。</p>

<p>アプリケーションの詳細情報を記入します。</p>

<p>「Settings」タブのApplication typeを「Read only」から「Read and Write」に変更し、「Update this Twitter application’s setting」ボタンを押します。</p>

<p>「Details」タブの中にあるYour access tokenの「Create my access token」ボタンを押すと、「Access token」と「Access token secret」が発行されます。</p>

<p>「OAuth tool」タブに表示されている「consumerKey」「consumerSecret」「accessToken」「tokenSecret」を控えておきましょう。</p>

<p>
<a href="demo/webapi/exercise20/index.html" target="_blank" class="btn btn-default">
<i class="glyphicon glyphicon-play"></i> デモ
</a>
</p>

<pre class="prettyprint linenums">
&lt;!DOCTYPE HTML&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;&lt;/title&gt;
&lt;link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" /&gt;
&lt;script src="http://code.jquery.com/jquery-1.9.1.min.js"&gt;&lt;/script&gt;
&lt;script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"&gt;&lt;/script&gt;
<mark>&lt;script src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"&gt;&lt;/script&gt;
&lt;script src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"&gt;&lt;/script&gt;</mark>
&lt;script&gt;
//Twitterクラス定義
function Twitter() {}
//プロパティ
Twitter.prototype = <mark>{
        consumerKey:    "UpTXY5eoXBMqdh2hkPYscg",
        consumerSecret: "X3F83WWzR2j05TKpqsV7zR3Ut9jlZgI5mt0szMVNijU",
        accessToken:    "164538873-oY7G7JazQXMO0D8UEizKdZTBY9znwggkbRje8Q0c",
        tokenSecret:    "5j0TRWUl3QqgCo9mEBCNXHSwpaFrUE8n7jaAQhpQ"
}</mark>;
//メソッド
Twitter.prototype.get = function(api, content) {
    var accessor = {
        consumerSecret: this.consumerSecret,
        tokenSecret: this.tokenSecret
    };
 
    var message = {
        method: "GET",
        action: api,
        parameters: {
            oauth_version: "1.0",
            oauth_signature_method: "HMAC-SHA1",
            oauth_consumer_key: this.consumerKey,
            oauth_token: this.accessToken
        }
    };
    for (var key in content) {
        message.parameters[key] = content[key];
    }
    OAuth.setTimestampAndNonce(message);
    OAuth.SignatureMethod.sign(message, accessor);
    var target = OAuth.addToURL(message.action, message.parameters);
 
    var options = {
        type: message.method,
        url: target,
        dataType: "jsonp",  //ここでjsonpを指定する
        jsonp: false,       //jQueryによるcallback関数名の埋め込みはしない
        cache: true         //リクエストパラメータに時刻を埋め込まない
    };
    $.ajax(options);
}
 
//Twiterクラスインスタンス化
var twitter = new Twitter();
 
//コールバック関数
function update(data){
    for( var i = 0; i &lt; data.length; i++ ) {
        $('[data-role="listview"]').append(
            '&lt;li&gt;&lt;a href="#"&gt;\
            &lt;h2&gt;' + data[i].user.name + '&lt;/h2&gt;\
            &lt;p&gt;' + data[i].text + '&lt;/p&gt;\
            &lt;/a&gt;&lt;/li&gt;'
        ).listview('refresh');
    }
}

$(document).on('pageshow','#index',function(){
    //オプションとコールバック関数の指定
    var content = {
        count: "50",        //表示件数
        callback: "update"  //コールバック関数
    };
    //Twitter APIの呼び出し
    twitter.get("https://api.twitter.com/1.1/statuses/<mark>home_timeline</mark>.json", content);
});
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div data-role="page" id="index"&gt;
    &lt;div data-role="header"&gt;
        &lt;h1&gt;Twitter API（home_timeline）&lt;/h1&gt;
    &lt;/div&gt;
    &lt;div data-role="content"&gt;
        &lt;ul data-role="listview" data-inset="true"&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;div data-role="footer" data-position="fixed"&gt;
        &lt;h4&gt;Copyright &copy; ナカノヨウスケ&lt;/h4&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>

          </div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <div id="footer"><%= title %></div>
 
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>
    <script>prettyPrint();</script>
    <script src="js/bootstrap.min.js"></script>
    <script src="coffee/list-counter.js"></script>

  </body>
</html>